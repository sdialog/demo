<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDialog Web Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="bg-gray-900 text-white font-sans">
    <!-- Header -->
    <header class="bg-gray-800 p-4 shadow-md flex justify-between items-center">
        <h1 class="text-2xl font-bold">SDialog Web Demo</h1>
        <button id="settings-btn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
            Settings
        </button>
    </header>

    <div id="test-message" class="text-center p-2 bg-gray-700"></div>

    <!-- Main Content -->
    <main class="p-8">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">

            <!-- Step 1: Persona -->
            <div id="step-1" class="step-card bg-gray-800 p-6 rounded-lg shadow-lg">
                <h2 class="text-xl font-semibold mb-4 border-b border-gray-700 pb-2">1. Persona Management</h2>
                
                <!-- Create Persona Form -->
                <div class="mb-6">
                    <h3 class="font-semibold mb-2">Create a New Persona</h3>
                    <form id="create-persona-form" class="space-y-4">
                        <input type="text" id="name" name="name" placeholder="Name" required class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <input type="text" id="age" name="age" placeholder="Age" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <input type="text" id="gender" name="gender" placeholder="Gender" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <textarea id="background" name="background" placeholder="Background" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 h-24"></textarea>
                        <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Create Persona</button>
                    </form>
                </div>

                <!-- Generate Personas -->
                <div id="generate-personas-section" class="mb-6">
                    <h3 class="font-semibold mb-2">Or generate personas for both speakers</h3>
                    <button id="generate-speakers-btn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">Generate Speakers (speaker 1 & speaker 2)</button>
                </div>
                
                <!-- Personas List -->
                <div>
                    <h3 class="font-semibold mb-2">Available Personas</h3>
                    <div id="personas-list" class="space-y-4 max-h-96 overflow-y-auto"></div>
                </div>
            </div>

            <!-- Step 2: Voice Attribution -->
            <div id="step-2" class="step-card bg-gray-800 p-6 rounded-lg shadow-lg">
                <h2 class="text-xl font-semibold mb-4 border-b border-gray-700 pb-2">2. Voice Attribution</h2>
                
                <div id="voice-assignment-section" class="mb-6">
                    <button id="auto-assign-voices-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded mb-4">Auto-assign Voices</button>
                    <h3 class="font-semibold mb-2">Persona-Voice Assignments</h3>
                    <div id="persona-voice-assignments" class="p-4 bg-gray-700 rounded"></div>
                </div>
                
                <h3 class="collapsible collapsed font-semibold mb-2 cursor-pointer">Available Voices</h3>
                <div class="collapsible-content collapsed max-h-96 overflow-y-auto">
                    <div id="voices-list"></div>
                </div>
            </div>

            <!-- Step 3: Dialog Generation -->
            <div id="step-3" class="step-card bg-gray-800 p-6 rounded-lg shadow-lg">
                <h2 class="text-xl font-semibold mb-4 border-b border-gray-700 pb-2">3. Dialog Generation</h2>
                
                <form id="create-dialog-form" class="space-y-4 mb-6">
                    <select id="persona1" name="persona1" required class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2"></select>
                    <select id="persona2" name="persona2" required class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2"></select>
                    
                    <h3 class="font-semibold pt-2">Context</h3>
                    <input type="text" id="location" name="location" placeholder="Location" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2">
                    <input type="text" id="topics" name="topics" placeholder="Topics (comma-separated)" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2">
                    <input type="number" id="max_turns" name="max_turns" value="10" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2">
                    
                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Generate Dialog</button>
                </form>

                <h3 class="font-semibold mb-2">Generated Dialog</h3>
                <div id="dialog-display" class="p-4 bg-gray-700 rounded max-h-96 overflow-y-auto"></div>
            </div>

            <!-- Step 4: Room Generation -->
            <div id="step-4" class="step-card bg-gray-800 p-6 rounded-lg shadow-lg">
                <h2 class="text-xl font-semibold mb-4 border-b border-gray-700 pb-2">4. Room Generation</h2>
                
                <form id="create-room-form" class="space-y-4 mb-6">
                    <input type="text" id="room-name" name="name" placeholder="Room Name" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2">
                    
                    <div>
                        <label for="generator-type" class="block mb-2 text-sm font-medium">Generator Type:</label>
                        <select id="generator-type" name="generator_type" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2">
                            <option value="custom" selected>Custom Dimensions</option>
                            <option value="basic">Basic Room</option>
                            <option value="medical">Medical Room</option>
                        </select>
                    </div>

                    <div id="custom-params" class="space-y-4">
                        <div class="grid grid-cols-3 gap-4">
                           <input type="number" id="room-width" name="width" value="5" step="0.1" placeholder="Width" class="bg-gray-700 border border-gray-600 rounded px-3 py-2">
                           <input type="number" id="room-length" name="length" value="4" step="0.1" placeholder="Length" class="bg-gray-700 border border-gray-600 rounded px-3 py-2">
                           <input type="number" id="room-height" name="height" value="3" step="0.1" placeholder="Height" class="bg-gray-700 border border-gray-600 rounded px-3 py-2">
                        </div>
                    </div>
                    
                    <div id="basic-params" class="hidden space-y-4">
                        <div>
                           <label for="room-size" class="block mb-2 text-sm font-medium">Room Size (m²):</label>
                           <input type="number" id="room-size" name="room_size" value="20" step="0.1" placeholder="Room Size" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2">
                        </div>
                    </div>

                    <div id="medical-params" class="hidden space-y-4">
                        <div>
                            <label for="room-type" class="block mb-2 text-sm font-medium">Room Type:</label>
                            <select id="room-type" name="room_type" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2">
                                <option value="random" selected>Random</option>
                                <option value="consultation">Consultation (4.5m²)</option>
                                <option value="examination">Examination (6m²)</option>
                                <option value="treatment">Treatment (8m²)</option>
                                <option value="patient_room">Patient Room (9.5m²)</option>
                                <option value="surgery">Surgery (12m²)</option>
                                <option value="waiting_room">Waiting Room (15m²)</option>
                                <option value="emergency">Emergency (18m²)</option>
                                <option value="office">Office (20m²)</option>
                            </select>
                        </div>
                    </div>

                    <button type="submit" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-4 rounded">Create Room</button>
                </form>
            </div>

            <!-- Step 5: Audio Generation -->
            <div id="step-5" class="step-card bg-gray-800 p-6 rounded-lg shadow-lg">
                <h2 class="text-xl font-semibold mb-4 border-b border-gray-700 pb-2">5. Audio Generation</h2>
                <div id="audio-controls" class="space-y-4">
                    <select id="audio-room" name="audio-room" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2"></select>
                    <button id="generate-audio" class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-2 px-4 rounded">Generate Audio</button>
                </div>
            </div>

            <!-- Step 6: Listen -->
            <div id="step-6" class="step-card bg-gray-800 p-6 rounded-lg shadow-lg">
                <h2 class="text-xl font-semibold mb-4 border-b border-gray-700 pb-2">6. Listen to Audio</h2>
                <div id="audio-player" class="space-y-4"></div>
            </div>
        </div>

        <!-- Available Rooms Section -->
        <div class="mt-8">
            <h3 id="available-rooms-header" class="text-xl font-semibold mb-4">Available Rooms</h3>
            <div class="max-h-[50vh] overflow-y-auto pr-4"> <!-- pr-4 to avoid scrollbar overlap -->
                <div id="rooms-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-4">
                </div>
            </div>
        </div>
    </main>

    <!-- Room Image Modal -->
    <div id="room-image-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4">
        <div class="relative">
            <button id="close-room-image-modal-btn" class="absolute -top-4 -right-4 text-white text-3xl font-bold bg-gray-800 rounded-full w-10 h-10 flex items-center justify-center">&times;</button>
            <img id="zoomed-room-image" src="" alt="Zoomed room layout" class="max-w-full max-h-[90vh] rounded-lg">
        </div>
    </div>

    <!-- Add Furniture Modal -->
    <div id="add-furniture-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
        <div class="bg-gray-800 p-8 rounded-lg shadow-2xl w-full max-w-lg">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Add Furniture to <span id="furniture-modal-room-name"></span></h2>
                <button id="close-furniture-modal-btn" class="text-gray-400 hover:text-white">&times;</button>
            </div>
            <form id="add-furniture-form" class="space-y-4">
                <input type="hidden" id="furniture-room-id" name="room_id">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" name="name" placeholder="Furniture Name" required class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2">
                    <select name="color" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2">
                        <option value="RED">Red</option>
                        <option value="GREEN">Green</option>
                        <option value="BLUE">Blue</option>
                        <option value="YELLOW">Yellow</option>
                        <option value="PURPLE">Purple</option>
                        <option value="ORANGE">Orange</option>
                        <option value="PINK">Pink</option>
                        <option value="BROWN">Brown</option>
                        <option value="GRAY">Gray</option>
                        <option value="BLACK">Black</option>
                        <option value="WHITE">White</option>
                    </select>
                </div>
                <h3 class="font-semibold pt-2">Position (meters)</h3>
                <div class="grid grid-cols-3 gap-4">
                    <input type="number" name="x" value="0" step="0.1" placeholder="X" class="bg-gray-700 border border-gray-600 rounded px-3 py-2">
                    <input type="number" name="y" value="0" step="0.1" placeholder="Y" class="bg-gray-700 border border-gray-600 rounded px-3 py-2">
                    <input type="number" name="z" value="0" step="0.1" placeholder="Z" class="bg-gray-700 border border-gray-600 rounded px-3 py-2">
                </div>
                <h3 class="font-semibold pt-2">Dimensions (meters)</h3>
                <div class="grid grid-cols-3 gap-4">
                    <input type="number" name="width" value="1" step="0.1" placeholder="Width" class="bg-gray-700 border border-gray-600 rounded px-3 py-2">
                    <input type="number" name="height" value="1" step="0.1" placeholder="Height" class="bg-gray-700 border border-gray-600 rounded px-3 py-2">
                    <input type="number" name="depth" value="1" step="0.1" placeholder="Depth" class="bg-gray-700 border border-gray-600 rounded px-3 py-2">
                </div>
                <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded">Add Furniture</button>
            </form>
        </div>
    </div>

    <!-- Set Speaker Positions Modal -->
    <div id="set-speaker-positions-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
        <div class="bg-gray-800 p-8 rounded-lg shadow-2xl w-full max-w-2xl">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Set Speaker Positions for <span id="speaker-modal-room-name"></span></h2>
                <button id="close-speaker-modal-btn" class="text-gray-400 hover:text-white">&times;</button>
            </div>
            <form id="set-speaker-positions-form" class="space-y-6">
                <input type="hidden" id="speaker-room-id" name="room_id">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Speaker 1 Column -->
                    <div class="speaker-config-card p-4 bg-gray-700 rounded-md" data-speaker="speaker_1">
                        <h3 class="font-bold text-lg mb-4">Speaker 1</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block mb-2 text-sm font-medium">Placement Type:</label>
                                <select name="speaker_1_placement_type" class="w-full bg-gray-600 border border-gray-500 rounded px-3 py-2 speaker-placement-type">
                                    <option value="absolute">Absolute Position</option>
                                    <option value="relative">Relative to Furniture</option>
                                </select>
                            </div>
                            <div class="speaker-absolute-params space-y-2">
                                <h4 class="font-semibold text-sm">Absolute Position (m)</h4>
                                <div class="grid grid-cols-3 gap-2">
                                    <input type="number" name="speaker_1_x" value="0" step="0.1" placeholder="X" class="bg-gray-600 border border-gray-500 rounded px-3 py-2">
                                    <input type="number" name="speaker_1_y" value="0" step="0.1" placeholder="Y" class="bg-gray-600 border border-gray-500 rounded px-3 py-2">
                                    <input type="number" name="speaker_1_z" value="0" step="0.1" placeholder="Z" class="bg-gray-600 border border-gray-500 rounded px-3 py-2">
                                </div>
                            </div>
                            <div class="speaker-relative-params hidden space-y-2">
                                <h4 class="font-semibold text-sm">Relative Position</h4>
                                <div>
                                    <label class="block mb-1 text-xs">Furniture:</label>
                                    <select name="speaker_1_furniture_name" class="w-full bg-gray-600 border border-gray-500 rounded px-3 py-2 furniture-select"></select>
                                </div>
                                <div>
                                    <label class="block mb-1 text-xs">Side:</label>
                                    <select name="speaker_1_side" class="w-full bg-gray-600 border border-gray-500 rounded px-3 py-2">
                                        <option value="any">Any</option>
                                        <option value="front">Front</option>
                                        <option value="back">Back</option>
                                        <option value="left">Left</option>
                                        <option value="right">Right</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block mb-1 text-xs">Max Distance (m):</label>
                                    <input type="number" name="speaker_1_max_distance" value="0.3" step="0.1" class="w-full bg-gray-600 border border-gray-500 rounded px-3 py-2">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Speaker 2 Column -->
                    <div class="speaker-config-card p-4 bg-gray-700 rounded-md" data-speaker="speaker_2">
                        <h3 class="font-bold text-lg mb-4">Speaker 2</h3>
                        <div class="space-y-4">
                             <div>
                                <label class="block mb-2 text-sm font-medium">Placement Type:</label>
                                <select name="speaker_2_placement_type" class="w-full bg-gray-600 border border-gray-500 rounded px-3 py-2 speaker-placement-type">
                                    <option value="absolute">Absolute Position</option>
                                    <option value="relative">Relative to Furniture</option>
                                </select>
                            </div>
                            <div class="speaker-absolute-params space-y-2">
                                <h4 class="font-semibold text-sm">Absolute Position (m)</h4>
                                <div class="grid grid-cols-3 gap-2">
                                    <input type="number" name="speaker_2_x" value="0" step="0.1" placeholder="X" class="bg-gray-600 border border-gray-500 rounded px-3 py-2">
                                    <input type="number" name="speaker_2_y" value="0" step="0.1" placeholder="Y" class="bg-gray-600 border border-gray-500 rounded px-3 py-2">
                                    <input type="number" name="speaker_2_z" value="0" step="0.1" placeholder="Z" class="bg-gray-600 border border-gray-500 rounded px-3 py-2">
                                </div>
                            </div>
                            <div class="speaker-relative-params hidden space-y-2">
                                <h4 class="font-semibold text-sm">Relative Position</h4>
                                <div>
                                    <label class="block mb-1 text-xs">Furniture:</label>
                                    <select name="speaker_2_furniture_name" class="w-full bg-gray-600 border border-gray-500 rounded px-3 py-2 furniture-select"></select>
                                </div>
                                <div>
                                    <label class="block mb-1 text-xs">Side:</label>
                                    <select name="speaker_2_side" class="w-full bg-gray-600 border border-gray-500 rounded px-3 py-2">
                                        <option value="any">Any</option>
                                        <option value="front">Front</option>
                                        <option value="back">Back</option>
                                        <option value="left">Left</option>
                                        <option value="right">Right</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block mb-1 text-xs">Max Distance (m):</label>
                                    <input type="number" name="speaker_2_max_distance" value="0.3" step="0.1" class="w-full bg-gray-600 border border-gray-500 rounded px-3 py-2">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <button type="submit" class="w-full mt-6 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Set Speaker Positions</button>
            </form>
        </div>
    </div>

    <!-- Set Mic Position Modal -->
    <div id="set-mic-position-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
        <div class="bg-gray-800 p-8 rounded-lg shadow-2xl w-full max-w-md">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Set Mic Position for <span id="mic-modal-room-name"></span></h2>
                <button id="close-mic-modal-btn" class="text-gray-400 hover:text-white">&times;</button>
            </div>
            <form id="set-mic-position-form" class="space-y-4">
                <input type="hidden" id="mic-room-id" name="room_id">
                <div>
                    <label for="mic-position" class="block mb-2 text-sm font-medium">Position:</label>
                    <select id="mic-position" name="mic_position" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2">
                        <option value="desk_smartphone">Desk Smartphone</option>
                        <option value="monitor">Monitor</option>
                        <option value="wall_mounted">Wall Mounted</option>
                        <option value="ceiling_centered">Ceiling Centered</option>
                        <option value="chest_pocket_speaker_1">Chest Pocket (Speaker 1)</option>
                        <option value="chest_pocket_speaker_2">Chest Pocket (Speaker 2)</option>
                        <option value="middle_speakers">Middle of Speakers</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>
                <div id="custom-mic-position-params" class="hidden space-y-4 pt-2">
                    <h3 class="font-semibold">Custom Position (meters)</h3>
                    <div class="grid grid-cols-3 gap-4">
                        <input type="number" name="x" value="0" step="0.1" placeholder="X" class="bg-gray-700 border border-gray-600 rounded px-3 py-2">
                        <input type="number" name="y" value="0" step="0.1" placeholder="Y" class="bg-gray-700 border border-gray-600 rounded px-3 py-2">
                        <input type="number" name="z" value="0" step="0.1" placeholder="Z" class="bg-gray-700 border border-gray-600 rounded px-3 py-2">
                    </div>
                </div>
                <button type="submit" class="w-full bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 px-4 rounded">Set Position</button>
            </form>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
        <div class="bg-gray-800 p-8 rounded-lg shadow-2xl w-full max-w-md">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Settings</h2>
                <button id="close-modal-btn" class="text-gray-400 hover:text-white">&times;</button>
            </div>
            
            <div id="llm-config" class="space-y-4">
                <h3 class="text-lg font-semibold">LLM Configuration</h3>
                <div>
                    <label for="llm-provider" class="block mb-2 text-sm font-medium">Provider:</label>
                    <select id="llm-provider" name="provider" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2">
                        <option value="ollama" selected>Ollama</option>
                        <option value="huggingface">HuggingFace</option>
                        <option value="openai">OpenAI</option>
                        <option value="amazon">Amazon Bedrock</option>
                        <option value="google">Google</option>
                    </select>
                </div>
                <div>
                    <label for="llm-model-name" class="block mb-2 text-sm font-medium">Model Name:</label>
                    <input type="text" id="llm-model-name" name="model_name" value="llama2" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2">
                </div>
                
                <div id="bedrock-options" style="display: none;" class="space-y-4 p-4 border border-gray-700 rounded">
                    <h4 class="font-semibold">Amazon Bedrock Options</h4>
                    <div>
                        <label for="aws-region" class="block mb-2 text-sm font-medium">AWS Region:</label>
                        <input type="text" id="aws-region" name="region_name" value="us-east-1" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2">
                    </div>
                    <div>
                        <label for="aws-bearer-token" class="block mb-2 text-sm font-medium">AWS Bearer Token:</label>
                        <input type="text" id="aws-bearer-token" name="aws_bearer_token" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>
